(function(o,c){typeof exports=="object"&&typeof module!="undefined"?c(exports):typeof define=="function"&&define.amd?define(["exports"],c):(o=typeof globalThis!="undefined"?globalThis:o||self,c(o.FSRS={}))})(this,function(o){"use strict";var c=(r=>(r[r.New=0]="New",r[r.Learning=1]="Learning",r[r.Review=2]="Review",r[r.Relearning=3]="Relearning",r))(c||{}),l=(r=>(r[r.Manual=0]="Manual",r[r.Again=1]="Again",r[r.Hard=2]="Hard",r[r.Good=3]="Good",r[r.Easy=4]="Easy",r))(l||{}),ht=Object.defineProperty,ot=Object.defineProperties,ct=Object.getOwnPropertyDescriptors,G=Object.getOwnPropertySymbols,ft=Object.prototype.hasOwnProperty,yt=Object.prototype.propertyIsEnumerable,N=(r,t,e)=>t in r?ht(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,T=(r,t)=>{for(var e in t||(t={}))ft.call(t,e)&&N(r,e,t[e]);if(G)for(var e of G(t))yt.call(t,e)&&N(r,e,t[e]);return r},k=(r,t)=>ot(r,ct(t));class u{static card(t){return k(T({},t),{state:u.state(t.state),due:u.time(t.due),last_review:t.last_review?u.time(t.last_review):void 0})}static rating(t){if(typeof t=="string"){const e=t.charAt(0).toUpperCase(),i=t.slice(1).toLowerCase(),a=l[`${e}${i}`];if(a===void 0)throw new Error(`Invalid rating:[${t}]`);return a}else if(typeof t=="number")return t;throw new Error(`Invalid rating:[${t}]`)}static state(t){if(typeof t=="string"){const e=t.charAt(0).toUpperCase(),i=t.slice(1).toLowerCase(),a=c[`${e}${i}`];if(a===void 0)throw new Error(`Invalid state:[${t}]`);return a}else if(typeof t=="number")return t;throw new Error(`Invalid state:[${t}]`)}static time(t){if(typeof t=="object"&&t instanceof Date)return t;if(typeof t=="string"){const e=Date.parse(t);if(isNaN(e))throw new Error(`Invalid date:[${t}]`);return new Date(e)}else if(typeof t=="number")return new Date(t);throw new Error(`Invalid date:[${t}]`)}static review_log(t){return k(T({},t),{due:u.time(t.due),rating:u.rating(t.rating),state:u.state(t.state),review:u.time(t.review)})}}const _t="4.7.0";Date.prototype.scheduler=function(r,t){return z(this,r,t)},Date.prototype.diff=function(r,t){return U(this,r,t)},Date.prototype.format=function(){return q(this)},Date.prototype.dueFormat=function(r,t,e){return Y(this,r,t,e)};function z(r,t,e){return new Date(e?u.time(r).getTime()+t*24*60*60*1e3:u.time(r).getTime()+t*60*1e3)}function U(r,t,e){if(!r||!t)throw new Error("Invalid date");const i=u.time(r).getTime()-u.time(t).getTime();let a=0;switch(e){case"days":a=Math.floor(i/(24*60*60*1e3));break;case"minutes":a=Math.floor(i/(60*1e3));break}return a}function q(r){const t=u.time(r),e=t.getFullYear(),i=t.getMonth()+1,a=t.getDate(),s=t.getHours(),n=t.getMinutes(),d=t.getSeconds();return`${e}-${p(i)}-${p(a)} ${p(s)}:${p(n)}:${p(d)}`}function p(r){return r<10?`0${r}`:`${r}`}const $=[60,60,24,31,12],D=["second","min","hour","day","month","year"];function Y(r,t,e,i=D){r=u.time(r),t=u.time(t),i.length!==D.length&&(i=D);let a=r.getTime()-t.getTime(),s;for(a/=1e3,s=0;s<$.length&&!(a<$[s]);s++)a/=$[s];return`${Math.floor(a)}${e?i[s]:""}`}function mt(r){return u.time(r)}function gt(r){return u.state(r)}function wt(r){return u.rating(r)}const V=[l.Again,l.Hard,l.Good,l.Easy],vt=[{start:2.5,end:7,factor:.15},{start:7,end:20,factor:.1},{start:20,end:1/0,factor:.05}];function W(r,t,e){let i=1;for(const n of vt)i+=n.factor*Math.max(Math.min(r,n.end)-n.start,0);r=Math.min(r,e);let a=Math.max(2,Math.round(r-i));const s=Math.min(Math.round(r+i),e);return r>t&&(a=Math.max(a,t+1)),a=Math.min(a,s),{min_ivl:a,max_ivl:s}}function g(r,t,e){return Math.min(Math.max(r,t),e)}function X(r,t){const e=Date.UTC(r.getUTCFullYear(),r.getUTCMonth(),r.getUTCDate()),i=Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate());return Math.floor((i-e)/864e5)}const B=.9,J=36500,K=[.40255,1.18385,3.173,15.69105,7.1949,.5345,1.4604,.0046,1.54575,.1192,1.01925,1.9395,.11,.29605,2.2698,.2315,2.9898,.51655,.6621],Q=!1,Z=!0,bt=`v${_t} using FSRS-5.0`,_=.01,x=100,A=[[_,x],[_,x],[_,x],[_,x],[1,10],[.001,4],[.001,4],[.001,.75],[0,4.5],[0,.8],[.001,3.5],[.001,5],[.001,.25],[.001,.9],[0,4],[0,1],[1,6],[0,2],[0,2]],F=r=>{var t,e;let i=K;return r!=null&&r.w&&(r.w.length===19?i=r==null?void 0:r.w:r.w.length===17&&(i=r==null?void 0:r.w.concat([0,0]),i[4]=+(i[5]*2+i[4]).toFixed(8),i[5]=+(Math.log(i[5]*3+1)/3).toFixed(8),i[6]=+(i[6]+.5).toFixed(8),console.debug("[FSRS V5]auto fill w to 19 length"))),i=i.map((a,s)=>g(a,A[s][0],A[s][1])),{request_retention:(r==null?void 0:r.request_retention)||B,maximum_interval:(r==null?void 0:r.maximum_interval)||J,w:i,enable_fuzz:(t=r==null?void 0:r.enable_fuzz)!=null?t:Q,enable_short_term:(e=r==null?void 0:r.enable_short_term)!=null?e:Z}};function M(r,t){const e={due:r?u.time(r):new Date,stability:0,difficulty:0,elapsed_days:0,scheduled_days:0,reps:0,lapses:0,state:c.New,last_review:void 0};return t&&typeof t=="function"?t(e):e}var pt=Object.defineProperty,xt=(r,t,e)=>t in r?pt(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,S=(r,t,e)=>xt(r,typeof t!="symbol"?t+"":t,e);let Mt=class{constructor(t){S(this,"c"),S(this,"s0"),S(this,"s1"),S(this,"s2");const e=St();this.c=1,this.s0=e(" "),this.s1=e(" "),this.s2=e(" "),t==null&&(t=+new Date),this.s0-=e(t),this.s0<0&&(this.s0+=1),this.s1-=e(t),this.s1<0&&(this.s1+=1),this.s2-=e(t),this.s2<0&&(this.s2+=1)}next(){const t=2091639*this.s0+this.c*23283064365386963e-26;return this.s0=this.s1,this.s1=this.s2,this.s2=t-(this.c=t|0),this.s2}set state(t){this.c=t.c,this.s0=t.s0,this.s1=t.s1,this.s2=t.s2}get state(){return{c:this.c,s0:this.s0,s1:this.s1,s2:this.s2}}};function St(){let r=4022871197;return function(t){t=String(t);for(let e=0;e<t.length;e++){r+=t.charCodeAt(e);let i=.02519603282416938*r;r=i>>>0,i-=r,i*=r,r=i>>>0,i-=r,r+=i*4294967296}return(r>>>0)*23283064365386963e-26}}function Et(r){const t=new Mt(r),e=()=>t.next();return e.int32=()=>t.next()*4294967296|0,e.double=()=>e()+(e()*2097152|0)*11102230246251565e-32,e.state=()=>t.state,e.importState=i=>(t.state=i,e),e}var Rt=Object.defineProperty,$t=(r,t,e)=>t in r?Rt(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,E=(r,t,e)=>$t(r,typeof t!="symbol"?t+"":t,e);const O=-.5,I=19/81;function tt(r,t){return+Math.pow(1+I*r/t,O).toFixed(8)}class et{constructor(t){E(this,"param"),E(this,"intervalModifier"),E(this,"_seed"),E(this,"forgetting_curve",tt),this.param=new Proxy(F(t),this.params_handler_proxy()),this.intervalModifier=this.calculate_interval_modifier(this.param.request_retention)}get interval_modifier(){return this.intervalModifier}set seed(t){this._seed=t}calculate_interval_modifier(t){if(t<=0||t>1)throw new Error("Requested retention rate should be in the range (0,1]");return+((Math.pow(t,1/O)-1)/I).toFixed(8)}get parameters(){return this.param}set parameters(t){this.update_parameters(t)}params_handler_proxy(){const t=this;return{set:function(e,i,a){return i==="request_retention"&&Number.isFinite(a)&&(t.intervalModifier=t.calculate_interval_modifier(Number(a))),Reflect.set(e,i,a),!0}}}update_parameters(t){const e=F(t);for(const i in e)if(i in this.param){const a=i;this.param[a]=e[a]}}init_stability(t){return Math.max(this.param.w[t-1],.1)}init_difficulty(t){return this.constrain_difficulty(this.param.w[4]-Math.exp((t-1)*this.param.w[5])+1)}apply_fuzz(t,e){if(!this.param.enable_fuzz||t<2.5)return Math.round(t);const i=Et(this._seed)(),{min_ivl:a,max_ivl:s}=W(t,e,this.param.maximum_interval);return Math.floor(i*(s-a+1)+a)}next_interval(t,e){const i=Math.min(Math.max(1,Math.round(t*this.intervalModifier)),this.param.maximum_interval);return this.apply_fuzz(i,e)}linear_damping(t,e){return+(t*(10-e)/9).toFixed(8)}next_difficulty(t,e){const i=-this.param.w[6]*(e-3),a=t+this.linear_damping(i,t);return this.constrain_difficulty(this.mean_reversion(this.init_difficulty(l.Easy),a))}constrain_difficulty(t){return Math.min(Math.max(+t.toFixed(8),1),10)}mean_reversion(t,e){return+(this.param.w[7]*t+(1-this.param.w[7])*e).toFixed(8)}next_recall_stability(t,e,i,a){const s=l.Hard===a?this.param.w[15]:1,n=l.Easy===a?this.param.w[16]:1;return+g(e*(1+Math.exp(this.param.w[8])*(11-t)*Math.pow(e,-this.param.w[9])*(Math.exp((1-i)*this.param.w[10])-1)*s*n),_,36500).toFixed(8)}next_forget_stability(t,e,i){return+g(this.param.w[11]*Math.pow(t,-this.param.w[12])*(Math.pow(e+1,this.param.w[13])-1)*Math.exp((1-i)*this.param.w[14]),_,36500).toFixed(8)}next_short_term_stability(t,e){return+g(t*Math.exp(this.param.w[17]*(e-3+this.param.w[18])),_,36500).toFixed(8)}next_state(t,e,i){const{difficulty:a,stability:s}=t!=null?t:{difficulty:0,stability:0};if(e<0)throw new Error(`Invalid delta_t "${e}"`);if(i<0||i>4)throw new Error(`Invalid grade "${i}"`);if(a===0&&s===0)return{difficulty:this.init_difficulty(i),stability:this.init_stability(i)};if(i===0)return{difficulty:a,stability:s};if(a<1||s<_)throw new Error(`Invalid memory state { difficulty: ${a}, stability: ${s} }`);const n=this.forgetting_curve(e,s),d=this.next_recall_stability(a,s,n,i),h=this.next_forget_stability(a,s,n),f=this.next_short_term_stability(s,i);let y=d;if(i===1){let[m,b]=[0,0];this.param.enable_short_term&&(m=this.param.w[17],b=this.param.w[18]);const w=s/Math.exp(m*b);y=g(+w.toFixed(8),_,h)}return e===0&&this.param.enable_short_term&&(y=f),{difficulty:this.next_difficulty(a,i),stability:y}}}function H(){const r=this.review_time.getTime(),t=this.current.reps,e=this.current.difficulty*this.current.stability;return`${r}_${t}_${e}`}function Dt(r){return function(){var t;const e=(t=Reflect.get(this.current,r))!=null?t:0,i=this.current.reps;return String(e+i||0)}}var R=(r=>(r.SCHEDULER="Scheduler",r.SEED="Seed",r))(R||{}),At=Object.defineProperty,Ft=(r,t,e)=>t in r?At(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,v=(r,t,e)=>Ft(r,typeof t!="symbol"?t+"":t,e);class L{constructor(t,e,i,a={seed:H}){v(this,"last"),v(this,"current"),v(this,"review_time"),v(this,"next",new Map),v(this,"algorithm"),v(this,"initSeedStrategy"),this.algorithm=i,this.initSeedStrategy=a.seed.bind(this),this.last=u.card(t),this.current=u.card(t),this.review_time=u.time(e),this.init()}init(){const{state:t,last_review:e}=this.current;let i=0;t!==c.New&&e&&(i=X(e,this.review_time)),this.current.last_review=this.review_time,this.current.elapsed_days=i,this.current.reps+=1,this.algorithm.seed=this.initSeedStrategy()}preview(){return{[l.Again]:this.review(l.Again),[l.Hard]:this.review(l.Hard),[l.Good]:this.review(l.Good),[l.Easy]:this.review(l.Easy),[Symbol.iterator]:this.previewIterator.bind(this)}}*previewIterator(){for(const t of V)yield this.review(t)}review(t){const{state:e}=this.last;let i;switch(e){case c.New:i=this.newState(t);break;case c.Learning:case c.Relearning:i=this.learningState(t);break;case c.Review:i=this.reviewState(t);break}if(i)return i;throw new Error("Invalid grade")}buildLog(t){const{last_review:e,due:i,elapsed_days:a}=this.last;return{rating:t,state:this.current.state,due:e||i,stability:this.current.stability,difficulty:this.current.difficulty,elapsed_days:this.current.elapsed_days,last_elapsed_days:a,scheduled_days:this.current.scheduled_days,review:this.review_time}}}let it=class extends L{newState(t){const e=this.next.get(t);if(e)return e;const i=u.card(this.current);switch(i.difficulty=this.algorithm.init_difficulty(t),i.stability=this.algorithm.init_stability(t),t){case l.Again:i.scheduled_days=0,i.due=this.review_time.scheduler(1),i.state=c.Learning;break;case l.Hard:i.scheduled_days=0,i.due=this.review_time.scheduler(5),i.state=c.Learning;break;case l.Good:i.scheduled_days=0,i.due=this.review_time.scheduler(10),i.state=c.Learning;break;case l.Easy:{const s=this.algorithm.next_interval(i.stability,this.current.elapsed_days);i.scheduled_days=s,i.due=this.review_time.scheduler(s,!0),i.state=c.Review;break}default:throw new Error("Invalid grade")}const a={card:i,log:this.buildLog(t)};return this.next.set(t,a),a}learningState(t){const e=this.next.get(t);if(e)return e;const{state:i,difficulty:a,stability:s}=this.last,n=u.card(this.current),d=this.current.elapsed_days;switch(n.difficulty=this.algorithm.next_difficulty(a,t),n.stability=this.algorithm.next_short_term_stability(s,t),t){case l.Again:{n.scheduled_days=0,n.due=this.review_time.scheduler(5,!1),n.state=i;break}case l.Hard:{n.scheduled_days=0,n.due=this.review_time.scheduler(10),n.state=i;break}case l.Good:{const f=this.algorithm.next_interval(n.stability,d);n.scheduled_days=f,n.due=this.review_time.scheduler(f,!0),n.state=c.Review;break}case l.Easy:{const f=this.algorithm.next_short_term_stability(s,l.Good),y=this.algorithm.next_interval(f,d),m=Math.max(this.algorithm.next_interval(n.stability,d),y+1);n.scheduled_days=m,n.due=this.review_time.scheduler(m,!0),n.state=c.Review;break}default:throw new Error("Invalid grade")}const h={card:n,log:this.buildLog(t)};return this.next.set(t,h),h}reviewState(t){const e=this.next.get(t);if(e)return e;const i=this.current.elapsed_days,{difficulty:a,stability:s}=this.last,n=this.algorithm.forgetting_curve(i,s),d=u.card(this.current),h=u.card(this.current),f=u.card(this.current),y=u.card(this.current);this.next_ds(d,h,f,y,a,s,n),this.next_interval(d,h,f,y,i),this.next_state(d,h,f,y),d.lapses+=1;const m={card:d,log:this.buildLog(l.Again)},b={card:h,log:super.buildLog(l.Hard)},w={card:f,log:super.buildLog(l.Good)},C={card:y,log:super.buildLog(l.Easy)};return this.next.set(l.Again,m),this.next.set(l.Hard,b),this.next.set(l.Good,w),this.next.set(l.Easy,C),this.next.get(t)}next_ds(t,e,i,a,s,n,d){t.difficulty=this.algorithm.next_difficulty(s,l.Again);const h=n/Math.exp(this.algorithm.parameters.w[17]*this.algorithm.parameters.w[18]),f=this.algorithm.next_forget_stability(s,n,d);t.stability=g(+h.toFixed(8),_,f),e.difficulty=this.algorithm.next_difficulty(s,l.Hard),e.stability=this.algorithm.next_recall_stability(s,n,d,l.Hard),i.difficulty=this.algorithm.next_difficulty(s,l.Good),i.stability=this.algorithm.next_recall_stability(s,n,d,l.Good),a.difficulty=this.algorithm.next_difficulty(s,l.Easy),a.stability=this.algorithm.next_recall_stability(s,n,d,l.Easy)}next_interval(t,e,i,a,s){let n,d;n=this.algorithm.next_interval(e.stability,s),d=this.algorithm.next_interval(i.stability,s),n=Math.min(n,d),d=Math.max(d,n+1);const h=Math.max(this.algorithm.next_interval(a.stability,s),d+1);t.scheduled_days=0,t.due=this.review_time.scheduler(5),e.scheduled_days=n,e.due=this.review_time.scheduler(n,!0),i.scheduled_days=d,i.due=this.review_time.scheduler(d,!0),a.scheduled_days=h,a.due=this.review_time.scheduler(h,!0)}next_state(t,e,i,a){t.state=c.Relearning,e.state=c.Review,i.state=c.Review,a.state=c.Review}};class rt extends L{newState(t){const e=this.next.get(t);if(e)return e;this.current.scheduled_days=0,this.current.elapsed_days=0;const i=u.card(this.current),a=u.card(this.current),s=u.card(this.current),n=u.card(this.current);return this.init_ds(i,a,s,n),this.next_interval(i,a,s,n,0),this.next_state(i,a,s,n),this.update_next(i,a,s,n),this.next.get(t)}init_ds(t,e,i,a){t.difficulty=this.algorithm.init_difficulty(l.Again),t.stability=this.algorithm.init_stability(l.Again),e.difficulty=this.algorithm.init_difficulty(l.Hard),e.stability=this.algorithm.init_stability(l.Hard),i.difficulty=this.algorithm.init_difficulty(l.Good),i.stability=this.algorithm.init_stability(l.Good),a.difficulty=this.algorithm.init_difficulty(l.Easy),a.stability=this.algorithm.init_stability(l.Easy)}learningState(t){return this.reviewState(t)}reviewState(t){const e=this.next.get(t);if(e)return e;const i=this.current.elapsed_days,{difficulty:a,stability:s}=this.last,n=this.algorithm.forgetting_curve(i,s),d=u.card(this.current),h=u.card(this.current),f=u.card(this.current),y=u.card(this.current);return this.next_ds(d,h,f,y,a,s,n),this.next_interval(d,h,f,y,i),this.next_state(d,h,f,y),d.lapses+=1,this.update_next(d,h,f,y),this.next.get(t)}next_ds(t,e,i,a,s,n,d){t.difficulty=this.algorithm.next_difficulty(s,l.Again);const h=this.algorithm.next_forget_stability(s,n,d);t.stability=g(n,_,h),e.difficulty=this.algorithm.next_difficulty(s,l.Hard),e.stability=this.algorithm.next_recall_stability(s,n,d,l.Hard),i.difficulty=this.algorithm.next_difficulty(s,l.Good),i.stability=this.algorithm.next_recall_stability(s,n,d,l.Good),a.difficulty=this.algorithm.next_difficulty(s,l.Easy),a.stability=this.algorithm.next_recall_stability(s,n,d,l.Easy)}next_interval(t,e,i,a,s){let n,d,h,f;n=this.algorithm.next_interval(t.stability,s),d=this.algorithm.next_interval(e.stability,s),h=this.algorithm.next_interval(i.stability,s),f=this.algorithm.next_interval(a.stability,s),n=Math.min(n,d),d=Math.max(d,n+1),h=Math.max(h,d+1),f=Math.max(f,h+1),t.scheduled_days=n,t.due=this.review_time.scheduler(n,!0),e.scheduled_days=d,e.due=this.review_time.scheduler(d,!0),i.scheduled_days=h,i.due=this.review_time.scheduler(h,!0),a.scheduled_days=f,a.due=this.review_time.scheduler(f,!0)}next_state(t,e,i,a){t.state=c.Review,e.state=c.Review,i.state=c.Review,a.state=c.Review}update_next(t,e,i,a){const s={card:t,log:this.buildLog(l.Again)},n={card:e,log:super.buildLog(l.Hard)},d={card:i,log:super.buildLog(l.Good)},h={card:a,log:super.buildLog(l.Easy)};this.next.set(l.Again,s),this.next.set(l.Hard,n),this.next.set(l.Good,d),this.next.set(l.Easy,h)}}var Ot=Object.defineProperty,It=Object.defineProperties,Ht=Object.getOwnPropertyDescriptors,at=Object.getOwnPropertySymbols,Lt=Object.prototype.hasOwnProperty,Pt=Object.prototype.propertyIsEnumerable,P=(r,t,e)=>t in r?Ot(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,jt=(r,t)=>{for(var e in t||(t={}))Lt.call(t,e)&&P(r,e,t[e]);if(at)for(var e of at(t))Pt.call(t,e)&&P(r,e,t[e]);return r},Ct=(r,t)=>It(r,Ht(t)),Gt=(r,t,e)=>P(r,t+"",e);class Nt{constructor(t){Gt(this,"fsrs"),this.fsrs=t}replay(t,e,i){return this.fsrs.next(t,e,i)}handleManualRating(t,e,i,a,s,n,d){if(typeof e=="undefined")throw new Error("reschedule: state is required for manual rating");let h,f;if(e===c.New)h={rating:l.Manual,state:e,due:d!=null?d:i,stability:t.stability,difficulty:t.difficulty,elapsed_days:a,last_elapsed_days:t.elapsed_days,scheduled_days:t.scheduled_days,review:i},f=M(i),f.last_review=i;else{if(typeof d=="undefined")throw new Error("reschedule: due is required for manual rating");const y=d.diff(i,"days");h={rating:l.Manual,state:t.state,due:t.last_review||t.due,stability:t.stability,difficulty:t.difficulty,elapsed_days:a,last_elapsed_days:t.elapsed_days,scheduled_days:t.scheduled_days,review:i},f=Ct(jt({},t),{state:e,due:d,last_review:i,stability:s||t.stability,difficulty:n||t.difficulty,elapsed_days:a,scheduled_days:y,reps:t.reps+1})}return{card:f,log:h}}reschedule(t,e){const i=[];let a=M(t.due);for(const s of e){let n;if(s.review=u.time(s.review),s.rating===l.Manual){let d=0;a.state!==c.New&&a.last_review&&(d=s.review.diff(a.last_review,"days")),n=this.handleManualRating(a,s.state,s.review,d,s.stability,s.difficulty,s.due?u.time(s.due):void 0)}else n=this.replay(a,s.review,s.rating);i.push(n),a=n.card}return i}calculateManualRecord(t,e,i,a){if(!i)return null;const{card:s,log:n}=i,d=u.card(t);return d.due.getTime()===s.due.getTime()?null:(d.scheduled_days=s.due.diff(d.due,"days"),this.handleManualRating(d,s.state,u.time(e),n.elapsed_days,a?s.stability:void 0,a?s.difficulty:void 0,s.due))}}var Tt=Object.defineProperty,kt=Object.defineProperties,zt=Object.getOwnPropertyDescriptors,st=Object.getOwnPropertySymbols,Ut=Object.prototype.hasOwnProperty,qt=Object.prototype.propertyIsEnumerable,j=(r,t,e)=>t in r?Tt(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,nt=(r,t)=>{for(var e in t||(t={}))Ut.call(t,e)&&j(r,e,t[e]);if(st)for(var e of st(t))qt.call(t,e)&&j(r,e,t[e]);return r},lt=(r,t)=>kt(r,zt(t)),dt=(r,t,e)=>j(r,typeof t!="symbol"?t+"":t,e);class ut extends et{constructor(t){super(t),dt(this,"strategyHandler",new Map),dt(this,"Scheduler");const{enable_short_term:e}=this.parameters;this.Scheduler=e?it:rt}params_handler_proxy(){const t=this;return{set:function(e,i,a){return i==="request_retention"&&Number.isFinite(a)?t.intervalModifier=t.calculate_interval_modifier(Number(a)):i==="enable_short_term"&&(t.Scheduler=a===!0?it:rt),Reflect.set(e,i,a),!0}}}useStrategy(t,e){return this.strategyHandler.set(t,e),this}clearStrategy(t){return t?this.strategyHandler.delete(t):this.strategyHandler.clear(),this}getScheduler(t,e){const i=this.strategyHandler.get(R.SEED),a=this.strategyHandler.get(R.SCHEDULER)||this.Scheduler,s=i||H;return new a(t,e,this,{seed:s})}repeat(t,e,i){const a=this.getScheduler(t,e).preview();return i&&typeof i=="function"?i(a):a}next(t,e,i,a){const s=this.getScheduler(t,e),n=u.rating(i);if(n===l.Manual)throw new Error("Cannot review a manual rating");const d=s.review(n);return a&&typeof a=="function"?a(d):d}get_retrievability(t,e,i=!0){const a=u.card(t);e=e?u.time(e):new Date;const s=a.state!==c.New?Math.max(e.diff(a.last_review,"days"),0):0,n=a.state!==c.New?this.forgetting_curve(s,+a.stability.toFixed(8)):0;return i?`${(n*100).toFixed(2)}%`:n}rollback(t,e,i){const a=u.card(t),s=u.review_log(e);if(s.rating===l.Manual)throw new Error("Cannot rollback a manual rating");let n,d,h;switch(s.state){case c.New:n=s.due,d=void 0,h=0;break;case c.Learning:case c.Relearning:case c.Review:n=s.review,d=s.due,h=a.lapses-(s.rating===l.Again&&s.state===c.Review?1:0);break}const f=lt(nt({},a),{due:n,stability:s.stability,difficulty:s.difficulty,elapsed_days:s.last_elapsed_days,scheduled_days:s.scheduled_days,reps:Math.max(0,a.reps-1),lapses:Math.max(0,h),state:s.state,last_review:d});return i&&typeof i=="function"?i(f):f}forget(t,e,i=!1,a){const s=u.card(t);e=u.time(e);const n=s.state===c.New?0:e.diff(s.last_review,"days"),d={rating:l.Manual,state:s.state,due:s.due,stability:s.stability,difficulty:s.difficulty,elapsed_days:0,last_elapsed_days:s.elapsed_days,scheduled_days:n,review:e},h={card:lt(nt({},s),{due:e,stability:0,difficulty:0,elapsed_days:0,scheduled_days:0,reps:i?0:s.reps,lapses:i?0:s.lapses,state:c.New,last_review:s.last_review}),log:d};return a&&typeof a=="function"?a(h):h}reschedule(t,e=[],i={}){const{recordLogHandler:a,reviewsOrderBy:s,skipManual:n=!0,now:d=new Date,update_memory_state:h=!1}=i;s&&typeof s=="function"&&e.sort(s),n&&(e=e.filter(C=>C.rating!==l.Manual));const f=new Nt(this),y=f.reschedule(i.first_card||M(),e),m=y.length,b=u.card(t),w=f.calculateManualRecord(b,d,m?y[m-1]:void 0,h);return a&&typeof a=="function"?{collections:y.map(a),reschedule_item:w?a(w):null}:{collections:y,reschedule_item:w}}}const Yt=r=>new ut(r||{});o.AbstractScheduler=L,o.CLAMP_PARAMETERS=A,o.DECAY=O,o.DefaultInitSeedStrategy=H,o.FACTOR=I,o.FSRS=ut,o.FSRSAlgorithm=et,o.FSRSVersion=bt,o.GenSeedStrategyWithCardId=Dt,o.Grades=V,o.INIT_S_MAX=x,o.Rating=l,o.S_MIN=_,o.State=c,o.StrategyMode=R,o.TypeConvert=u,o.clamp=g,o.createEmptyCard=M,o.dateDiffInDays=X,o.date_diff=U,o.date_scheduler=z,o.default_enable_fuzz=Q,o.default_enable_short_term=Z,o.default_maximum_interval=J,o.default_request_retention=B,o.default_w=K,o.fixDate=mt,o.fixRating=wt,o.fixState=gt,o.forgetting_curve=tt,o.formatDate=q,o.fsrs=Yt,o.generatorParameters=F,o.get_fuzz_range=W,o.show_diff_message=Y});
//# sourceMappingURL=index.umd.js.map
